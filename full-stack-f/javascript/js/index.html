<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript | one nice blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/jscodev.ico">
    <meta name="description" content="knowledge sharing">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0">
    
    <link rel="preload" href="/assets/css/0.styles.60d486a0.css" as="style"><link rel="preload" href="/assets/js/app.f47b2c40.js" as="script"><link rel="preload" href="/assets/js/2.af72bc87.js" as="script"><link rel="preload" href="/assets/js/16.8674dabe.js" as="script"><link rel="preload" href="/assets/js/7.2e35d67b.js" as="script"><link rel="prefetch" href="/assets/js/10.a9bf79bb.js"><link rel="prefetch" href="/assets/js/11.a427e81e.js"><link rel="prefetch" href="/assets/js/12.0b2b7aa0.js"><link rel="prefetch" href="/assets/js/13.b6b3a056.js"><link rel="prefetch" href="/assets/js/14.64749a17.js"><link rel="prefetch" href="/assets/js/15.da68acb7.js"><link rel="prefetch" href="/assets/js/17.a549c9d8.js"><link rel="prefetch" href="/assets/js/18.9389fd29.js"><link rel="prefetch" href="/assets/js/19.c39a071e.js"><link rel="prefetch" href="/assets/js/20.1dece8a0.js"><link rel="prefetch" href="/assets/js/21.13812f92.js"><link rel="prefetch" href="/assets/js/22.05fd8773.js"><link rel="prefetch" href="/assets/js/23.17941b85.js"><link rel="prefetch" href="/assets/js/24.7023415c.js"><link rel="prefetch" href="/assets/js/25.1f5804ca.js"><link rel="prefetch" href="/assets/js/26.6b4e0d48.js"><link rel="prefetch" href="/assets/js/27.1b788c1d.js"><link rel="prefetch" href="/assets/js/28.af72a96f.js"><link rel="prefetch" href="/assets/js/29.9c6f3345.js"><link rel="prefetch" href="/assets/js/3.fdb7c397.js"><link rel="prefetch" href="/assets/js/4.9c26f943.js"><link rel="prefetch" href="/assets/js/5.d3f16d5a.js"><link rel="prefetch" href="/assets/js/6.231eabe3.js"><link rel="prefetch" href="/assets/js/8.25be8698.js"><link rel="prefetch" href="/assets/js/9.1875fa7a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60d486a0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">one nice blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/full-stack-f/vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/full-stack-f/vue-router/" class="nav-link">
  Vue-Router
</a></li><li class="dropdown-item"><!----> <a href="/full-stack-f/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/full-stack-f/javascript/es/" class="nav-link">
  ECMAScript
</a></li><li class="dropdown-subitem"><a href="/full-stack-f/javascript/js/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈之巅" class="dropdown-title"><span class="title">全栈之巅</span> <span class="arrow down"></span></button> <button type="button" aria-label="全栈之巅" class="mobile-dropdown-title"><span class="title">全栈之巅</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/full-stack-r/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/http/" class="nav-link">
  http
</a></li></ul></div></div><div class="nav-item"><a href="https://juejin.im/user/844055260962855" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大前端" class="dropdown-title"><span class="title">大前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="大前端" class="mobile-dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/full-stack-f/vite/" class="nav-link">
  Vite
</a></li><li class="dropdown-item"><!----> <a href="/full-stack-f/vue-router/" class="nav-link">
  Vue-Router
</a></li><li class="dropdown-item"><!----> <a href="/full-stack-f/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/full-stack-f/javascript/es/" class="nav-link">
  ECMAScript
</a></li><li class="dropdown-subitem"><a href="/full-stack-f/javascript/js/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  JavaScript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈之巅" class="dropdown-title"><span class="title">全栈之巅</span> <span class="arrow down"></span></button> <button type="button" aria-label="全栈之巅" class="mobile-dropdown-title"><span class="title">全栈之巅</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/full-stack-r/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/http/" class="nav-link">
  http
</a></li></ul></div></div><div class="nav-item"><a href="https://juejin.im/user/844055260962855" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/full-stack-f/javascript/js/#javascript-是如何在浏览器中运行的呢" class="sidebar-link">JavaScript 是如何在浏览器中运行的呢？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#js函数接参原理" class="sidebar-link">js函数接参原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#ast抽象语法树" class="sidebar-link">ast抽象语法树</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#indexdb" class="sidebar-link">indexDB</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#postmessage" class="sidebar-link">postMessage</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#web-workers" class="sidebar-link">Web Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#进程之间互相通讯" class="sidebar-link">进程之间互相通讯</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#引入外部脚本" class="sidebar-link">引入外部脚本</a></li></ul></li><li><a href="/full-stack-f/javascript/js/#事件分发器" class="sidebar-link">事件分发器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#web-components" class="sidebar-link">Web Components</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#custom-elements" class="sidebar-link">Custom elements</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#mutationobserver" class="sidebar-link">MutationObserver</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#shadow-dom" class="sidebar-link">Shadow DOM</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#template" class="sidebar-link">template</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#slot" class="sidebar-link">slot</a></li></ul></li><li><a href="/full-stack-f/javascript/js/#websocket" class="sidebar-link">WebSocket</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#raf" class="sidebar-link">RAF</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#性能优化" class="sidebar-link">性能优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/full-stack-f/javascript/js/#流媒体开发" class="sidebar-link">流媒体开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#webrtc" class="sidebar-link">WebRTC</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#媒体设备" class="sidebar-link">媒体设备</a></li><li class="sidebar-sub-header"><a href="/full-stack-f/javascript/js/#mse-media-source-extensions" class="sidebar-link">MSE(Media Source Extensions)</a></li></ul></li><li><a href="/full-stack-f/javascript/js/#获取位置信息" class="sidebar-link">获取位置信息</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript"><a href="#javascript" class="header-anchor">#</a> javascript</h1> <p><img src="/img/article/javascript/javascript-logo.jpg" alt=""></p> <h2 id="javascript-是如何在浏览器中运行的呢"><a href="#javascript-是如何在浏览器中运行的呢" class="header-anchor">#</a> JavaScript 是如何在浏览器中运行的呢？</h2> <p>是通过JavaScript引擎的把你的人类语言转化成机器所理解的语言。</p> <p>在编程中，通常有两种翻译方法将代码翻译成机器语言。你可以使用解释器或者编译器。</p> <p>使用解释器，翻译的过程基本上是一行一行及时生效的。</p> <p>使用编译器是提前执行翻译过程全部翻译完毕后运行。</p> <h2 id="js函数接参原理"><a href="#js函数接参原理" class="header-anchor">#</a> js函数接参原理</h2> <p>js中存储数据使用的内存大致分为两类:</p> <ol><li><p>栈内存 stack</p></li> <li><p>堆内存 heap</p></li></ol> <ul><li><p>栈内存：存储变量的（局部变量和全局变量）是连续分配的，静态的，效率相对较高</p></li> <li><p>堆内存：存储对象的（函数，数组，对象），动态的，效率相对较低，堆内存的体积是比较大的</p></li></ul> <p>调用函数的时候会在栈中对该方法分配一个栈帧，里面是要接的参数也就是函数内的局部变量，再将所有的实参值赋给形参。</p> <p>在该方法内对所有形参的操作都不会影响实参的数据，因为并没有操作它，而是操作函数独有的局部变量，当函数没有接收相匹配的参数时就会去全局查找匹配的变量，这时候操作的就是变量本身。这里跟js的值传递和引用传递意思是一样的。下面举个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">20</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 20</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">20</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 20</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 10</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 20</span>

</code></pre></div><h2 id="ast抽象语法树"><a href="#ast抽象语法树" class="header-anchor">#</a> ast抽象语法树</h2> <p><strong>什么是抽象语法树</strong></p> <p><strong>抽象语法树（abstract syntax code，AST）是源代码的抽象语法结构的树状表示</strong>，树上的每个节点都表示源代码中的一种结构，这所以说是抽象的，是因为抽象语法树并不会表示出真实语法出现的每一个细节，比如说，嵌套括号被隐含在树的结构中，并没有以节点的形式呈现。抽象语法树并不依赖于源语言的语法，也就是说语法分析阶段所采用的上下文无文文法，因为在写文法时，经常会对文法进行等价的转换（消除左递归，回溯，二义性等），这样会给文法分析引入一些多余的成分，对后续阶段造成不利影响，甚至会使合个阶段变得混乱。因些，很多编译器经常要独立地构造语法分析树，为前端，后端建立一个清晰的接口。</p> <p>上面的解释可能还是有点抽象，通俗的理解就是js代码的一种json格式，把代码拆分成小的词法单元，就像一个完整的机器被拆成小零件，使得我们可以更方便自由的去操作它。</p> <p>这里先给提供一个ast在线转换器，可以上去尝试一下理解更为深刻。<a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">在线ast转换器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>AST三板斧</strong></p> <ul><li>esprima 生成ast</li> <li>estraverse 遍历和更新ast</li> <li>escodegen 将ast重新生成源码</li></ul> <p>下面是一个小例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> esprima <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'esprima'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> estraverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'estraverse'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> escodegen <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'escodegen'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token string">'const a = 1'</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> esprima<span class="token punctuation">.</span><span class="token function">parseScript</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>




estraverse<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token function-variable function">enter</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'var'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> transformCode <span class="token operator">=</span> escodegen<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transformCode<span class="token punctuation">)</span> <span class="token comment">// var a = 1</span>
</code></pre></div><p>这样我们就把es6的const语法转换成var了。</p> <h2 id="indexdb"><a href="#indexdb" class="header-anchor">#</a> indexDB</h2> <p>日常开发中我们存储数据经常会使用<code>cookies</code>和<code>localStorage</code>、<code>sessionStorage</code>，但是这三种方式使用都有大小限制，当我们需要存储大数据的时候可能就会需要<code>indexDB</code>。</p> <p>下面来看一个小例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 创建数据</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'zs'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'ls'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>  
<span class="token comment">// 创建数据库对象，兼容写法</span>
<span class="token keyword">var</span> indexedDB <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB <span class="token operator">||</span> window<span class="token punctuation">.</span>msIndexedDB <span class="token operator">||</span> window<span class="token punctuation">.</span>mozIndexedDb <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitIndexedDb
<span class="token comment">// 打开数据库，两个参数（数据库名字，版本号），如果数据库不存在则创建一个新的库</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
<span class="token comment">// 数据库操作过程中出错，则错误回调被触发</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建一个新的数据库或者修改数据库版本号时触发</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">,</span>
  objectStore <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment">// 创建对象仓库用来存储数据，把id作为keyPath，keyPath必须保证不重复，相当于数据库的主键</span>
  <span class="token comment">// 判断是否存在对象仓库，如果不存在就创建</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 建立索引，name和age可能重复，因此unique设置为false</span>
  objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>unique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 确保在插入数据前对象仓库已经建立</span>
  objectStore<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在数据库对象上调用transaction()方法创建事务，如果查找一个对象仓库第一个参数就可以传个字符串，如果查多个对象仓库就可以传一个字符串数组。</span>
  <span class="token comment">// 第二个参数传访问模式readwrite表示读写，readonly表示只读</span>
  <span class="token keyword">var</span> userStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    <span class="token comment">// 将数据添加到数据仓库</span>
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      userStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 数据库操作一切正常，所有操作完毕后触发</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
  <span class="token comment">// 数据读取</span>
  <span class="token keyword">var</span> userStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
  <span class="token comment">// get(1)表示key值为1，除了get还有put更新，delete删除，add添加</span>
  <span class="token keyword">var</span> getUser <span class="token operator">=</span> userStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// 获取成功后的回调</span>
  getUser<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 或者可以使用索引查找</span>
  <span class="token keyword">var</span> userStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> getUser <span class="token operator">=</span> userStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'zs'</span><span class="token punctuation">)</span>
  getUser<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 因为一个事务可以完成多个请求，所以事务本身也有事件处理程序</span>
transaction<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// 整个事务被取消了</span>
<span class="token punctuation">}</span>
transaction<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// 整个事务都成功完成了</span>
<span class="token punctuation">}</span>

</code></pre></div><p>到这里对indexDB的尝试就结束了，感兴趣的伙伴可以去MDN了解更多用法。</p> <h2 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postMessage</h2> <p>window.postMessage() 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为https），端口号（443为https的默认值），以及主机  (两个页面的模数 <code>Document.domain</code>设置为相同的值) 时，这两个脚本才能相互通信。window.postMessage() 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。</p> <p>otherWindow.postMessage的参数：</p> <ul><li><p>otherWindow  其他窗口的一个引用，比如iframe的contentWindow属性、执行window.open返回的窗口对象、或者是命名过或数值索引的window.frames。</p></li> <li><p>message  将要发送到其他 window的数据。它将会被结构化克隆算法序列化。这意味着你可以不受什么限制的将数据对象安全的传送给目标窗口而无需自己序列化。</p></li> <li><p>targetOrigin  通过窗口的origin属性来指定哪些窗口能接收到消息事件，其值可以是字符串&quot;*&quot;（表示无限制）或者一个URI。在发送消息的时候，如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。这个机制用来控制消息可以发送到哪些窗口；例如，当用postMessage传送密码时，这个参数就显得尤为重要，必须保证它的值与这条包含密码的信息的预期接受者的origin属性完全一致，来防止密码被恶意的第三方截获。如果你明确的知道消息应该发送到哪个窗口，那么请始终提供一个有确切值的targetOrigin，而不是'*'。不提供确切的目标将导致数据泄露到任何对数据感兴趣的恶意站点。</p></li> <li><p>transfer  是一串和message 同时传递的 Transferable 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。</p></li></ul> <h2 id="web-workers"><a href="#web-workers" class="header-anchor">#</a> Web Workers</h2> <p>通过使用Web Workers，Web应用程序可以在独立于主线程的后台线程中，运行一个脚本操作。这样做的好处是可以在独立线程中执行费时的处理任务，从而允许主线程（通常是UI线程）不会因此被阻塞/放慢。由于worker会占用资源所以我们不应该大量使用，并且在每次使用完将它关闭<code>worker.terminate()</code>。</p> <p>使用构造函数（例如,Worker()）创建一个worker对象, 构造函数接受一个JavaScript文件URL — 这个文件包含了将在worker线程中运行的代码worker将运行在与当前 window不同的另一个全局上下文中，这个上下文由一个对象表示，标准情况下为DedicatedWorkerGlobalScope（标准workers由单个脚本使用; 共享workers使用SharedWorkerGlobalScope）。</p> <p>worker执行在主线程执行完之后。</p> <p>注意事项：</p> <ul><li><p>同源限制  分配给Worker线程运行的脚本文件，必须与主线程的脚本文件同源。</p></li> <li><p>DOM 限制  线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的DOM对象，也无法使用document、window、parent这些对象。</p></li> <li><p>通信联系  线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过postMessage完成。</p></li> <li><p>脚本限制  线程不能执行alert()方法和confirm()方法，但可以使用XMLHttpRequest对象发出请求。但是请求的responseXML与channel两个属性值始终返回null（fetch 仍可正常使用，没有类似的限制）。</p></li> <li><p>文件限制  线程无法读取本地文件，即不能打开本机的文件系统（file://），它所加载的脚本，必须来自网络。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 创建一个 worker 对象</span>

<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myWorker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 进行一些逻辑处理，比如postMessage通讯</span>
<span class="token punctuation">}</span>

myWorker<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 进行错误处理</span>
<span class="token punctuation">}</span>

<span class="token comment">// worker.js</span>

<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Worker: Message received from main script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> workerResult <span class="token operator">=</span> <span class="token string">'Result: '</span> <span class="token operator">+</span> result<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>workerResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>textContent <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><h3 id="进程之间互相通讯"><a href="#进程之间互相通讯" class="header-anchor">#</a> 进程之间互相通讯</h3> <p>一个<code>web worker</code>或者一个跨域的<code>iframe</code>都有自己的栈、堆和消息队列。两个不同的运行时只能通过<code>postMessage</code>方法进行通信。如果另一个运行时侦听<code>message</code>事件，则此方法会向该运行时添加消息。</p> <h3 id="引入外部脚本"><a href="#引入外部脚本" class="header-anchor">#</a> 引入外部脚本</h3> <ul><li>importScripts</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'script.js'</span><span class="token punctuation">,</span><span class="token string">'script1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="事件分发器"><a href="#事件分发器" class="header-anchor">#</a> 事件分发器</h2> <p>向一个指定的事件目标派发一个事件，并以合适的顺序<strong>同步调用</strong>目标元素相关的事件处理函数。标准事件处理规则(包括事件捕获和可选的冒泡过程)同样适用于通过手动的使用<code>dispatchEvent()</code>方法派发的事件。当该事件是可取消的(cancelable为true)并且至少一个该事件的事件处理方法调用了<code>Event.preventDefault()</code>，则返回值为<code>false</code>；否则返回<code>true</code>。</p> <p>注意点：与浏览器原生事件不同，原生事件是由DOM派发的，并通过event loop异步调用事件处理程序，而<code>dispatchEvent()</code>则是同步调用事件处理程序。在调用<code>dispatchEvent()</code>后，所有监听该事件的事件处理程序将在代码继续前执行并返回。<code>dispatchEvent()</code>是<code>create-init-dispatch</code>过程的最后一步，用于将事件调度到实现的事件模型中。可以使用<code>Event</code>构造函数来创建事件。</p> <p>以前用<code>createEvent</code>和<code>initEvent</code>方法来创建事件，不过它们已经过时，未来浏览器即将不支持，所以使用<code>Event</code>和<code>CustomEvent</code>替代。</p> <ul><li><p>Event</p> <ul><li><p>typeArg 表示所创建事件的名称</p></li> <li><p>eventInit 可选，是EventInit类型的字典，接受以下字段:</p> <ul><li>bubbles  Boolean类型，默认值为 false，表示该事件是否冒泡</li> <li>cancelable  Boolean类型，默认值为 false， 表示该事件能否被取消</li> <li>composed  Boolean类型，默认值为 false，表示事件是否会在影子DOM根节点之外触发侦听器</li></ul></li></ul></li> <li><p>CustomEvent</p> <ul><li><p>typeArg 表示所创建事件的名称</p></li> <li><p>customEventInit 可选，一个字典类型参数，有如下字段:</p> <ul><li>detail  可选的默认值是null的任意类型数据，是一个与event相关的值</li> <li>bubbles  一个布尔值，表示该事件能否冒泡。 来自EventInit。</li> <li>cancelable  一个布尔值，表示该事件是否可以取消</li></ul></li></ul></li></ul> <p><code>CustomEvent</code>可在Web Worker中可用。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 监听look自定义事件</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'look'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建Event对象</span>
<span class="token keyword">var</span> ev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">&quot;look&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;bubbles&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;cancelable&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过dispatchEvent调用自定义事件</span>
document<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 监听build自定义事件</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> eventHandler<span class="token punctuation">)</span>
<span class="token comment">// 创建CustomEvent对象</span>
<span class="token keyword">var</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'detail'</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过dispatchEvent调用自定义事件</span>
document<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token comment">// 自定义事件回调</span>
<span class="token keyword">function</span> <span class="token function">eventHandler</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The time is: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="web-components"><a href="#web-components" class="header-anchor">#</a> Web Components</h2> <p>Web Components可以用来创建封装功能的定制元素，可以在你喜欢的任何地方重用，不必担心代码冲突。</p> <p>实现Web Components需要使用到下面三个API：</p> <ul><li><p>Custom elements  用于定义自定义元素及其行为
<strong>参数</strong>：</p> <ul><li>name  自定义元素名</li> <li>constructor  自定义元素构造器</li> <li>options  （可选参数）控制元素如何定义，目前有一个选项支持:
<ul><li>extends. 指定继承的已创建的元素，被用于创建自定义元素
<strong>生命周期</strong>：</li></ul></li> <li>connectedCallback: 当自定义元素第一次被连接到文档DOM时被调用。</li> <li>disconnectedCallback: 当自定义元素与文档DOM断开连接时被调用。</li> <li>adoptedCallback: 当自定义元素被移动到新文档时被调用。</li> <li>attributeChangedCallback: 当自定义元素的一个属性被增加、移除或更改时被调用。</li></ul></li> <li><p>Shadow DOM  用于将封装的“影子”DOM树附加到元素（与主文档DOM分开呈现）并控制其关联的功能。通过这种方式可以保持元素的私有性，这样它们就可以被脚本化和样式化，而不用担心与文档的其他部分发生冲突。</p></li> <li><p>HTML templates  <code>&lt;template&gt;</code> 和 <code>&lt;slot&gt;</code> 元素可以编写不在呈现页面中显示的标记模板。然后它们可以作为自定义元素结构的基础被多次重用。</p></li></ul> <p>创建一个自定义元素可以选择两种类型：</p> <ul><li><p>自主定制元素：独立元素; 它们不会从内置HTML元素继承。</p></li> <li><p>自定义内置元素：这些元素继承自 - 并扩展 - 内置HTML元素</p></li></ul> <h3 id="custom-elements"><a href="#custom-elements" class="header-anchor">#</a> Custom elements</h3> <p>要想使用自定义元素customElements.define传入的元素名字必须要有‘-’（比如my-ele）并且类继承<code>HTMLElement</code>，或者使用extends继承<code>&lt;p&gt;</code>标签，需要用<code>is</code>声明自定义元素的<code>name</code>，不过要注意需要继承<code>HTMLParagraphElement</code>；<code>HTMLParagraphElement</code>接口可以提供超过其继承的HTMLElement 对象额外的属性 ，用以操作<code>&lt;p&gt;</code>元素（这里也可以用于其他标签，不过需要继承相应的接口，因为有很多我这就不列举了，可以去MDN搜索Web APIs查看）。</p> <p>继承原生标签可以使用标签自带的所有API，让我们不需要自己去实现点击等一系列事件，具有很强的扩展性让我们可以专注于添加自定义的方法。</p> <p>创建自定义元素的规则:</p> <ul><li><p>自定义元素的名称必须包含连字符（-）。比如<code>&lt;my-ele&gt;</code>、<code>&lt;my-element&gt;</code>都是有效名称，而<code>&lt;my&gt;</code>和<code>&lt;popup&gt;</code>不是。这是为了使HTML解析器可以区分自定义元素和常规元素。当将新标签添加到HTML时，它还可以确保向前兼容性</p></li> <li><p>不能多次注册同一标签</p></li> <li><p>标签不可以自闭合，每次创建都需要手动闭合<code>&lt;my-ele&gt;&lt;/my-ele&gt;</code>，否则会把其他元素包含在内无法显示</p></li></ul> <p>CustomElements的方法：</p> <ul><li><p>customElements.whenDefined('my-ele',MyEle)方法在自定义元素创建时执行，返回一个Promise</p></li> <li><p>customElements.get('my-ele')返回提供的自定义元素名称的类构造函数（如果尚未定义，则返回undefined）</p></li></ul> <p>看看下面的小例子：</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.hi</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-ele</span> <span class="token attr-name">disabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-ele</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>frame<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 创建自定义元素构造器</span>
  <span class="token keyword">class</span> <span class="token class-name">MyEle</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 此时的this指向类内部引用的DOM元素本身</span>
      <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
      text<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'hi'</span>
      text<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'hello Web Components'</span>
      <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
      style<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'.hi{color:red;}'</span>
      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>
      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">observedAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'disabled'</span><span class="token punctuation">,</span><span class="token string">'readonly'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">disabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connectedCallback'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'disconnectedCallback'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">adoptedCallback</span><span class="token punctuation">(</span><span class="token parameter">oldDocument<span class="token punctuation">,</span>newDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldDocument<span class="token punctuation">,</span>newDocument<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 注册自定义元素</span>
  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'my-ele'</span><span class="token punctuation">,</span>MyEle<span class="token punctuation">)</span>
  <span class="token comment">// 元素创建后触发</span>
  customElements<span class="token punctuation">.</span><span class="token function">whenDefined</span><span class="token punctuation">(</span><span class="token string">'my-ele'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi my-ele'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> frame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#frame'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contentDocument<span class="token punctuation">,</span>
      myEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'my-ele'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 因为移除节点后短时间内不会被内存回收，所以这里不用变量接收一样可以找到移除元素并插入</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>myEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  frame<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>myEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>注意点:</p> <ul><li><p><code>observedAttributes</code>是触发<code>attributeChangedCallback</code>回调的属性，<code>observedAttributes</code>里面配置监听的属性，才能被<code>attributeChangedCallback</code>监听。</p></li> <li><p>当你移动元素插入新文档的时候会先调用<code>adoptedCallback</code>然后再调用一次<code>connectedCallback</code>，所以初始化数据的一些操作最好不要放在<code>connectedCallback</code>。</p></li></ul> <h3 id="mutationobserver"><a href="#mutationobserver" class="header-anchor">#</a> MutationObserver</h3> <p><code>MutationObserver</code>提供了监视对DOM树所做更改的能力。它被设计为旧的Mutation Events功能的替代品，该功能是DOM3 Events规范的一部分。</p> <p><code>new MutationObserver(callback)</code>接收一个函数并返回新的<code>MutationObserver</code>，它有三个方法：</p> <ul><li><p>disconnect 阻止 MutationObserver 实例继续接收的通知，直到再次调用其observe()方法，该观察者对象包含的回调函数都不会再被调用。</p></li> <li><p>observe(target:Node,options:Object) 配置MutationObserver在DOM更改匹配给定选项时，通过其回调函数开始接收通知。</p> <p>options:</p> <ul><li><p>childList	设为 true 以监视目标节点（如果 subtree 为 true，则包含子孙节点）添加或删除新的子节点。默认值为 false</p></li> <li><p>attributes	设为true以观察受监视元素的属性值变更。默认值为 false</p></li> <li><p>characterData	设为true以监视指定目标节点或子节点树中节点所包含的字符数据的变化，无默认值</p></li> <li><p>subtree	设为true以将监视范围扩展至目标节点整个节点树中的所有节点。MutationObserverInit 的其他值也会作用于此子树下的所有节点，而不仅仅只作用于目标节点。默认值为false</p></li> <li><p>attributeOldValue	当监视节点的属性改动时，将此属性设为 true 将记录任何有改动的属性的上一个值。有关观察属性更改和值记录的详细信息，无默认值</p></li> <li><p>characterDataOldValue	设为true以在文本在受监视节点上发生更改时记录节点文本的先前值。详情及例子，请查看 Monitoring text content changes in MutationObserver，无默认值</p></li> <li><p>attributeFilter	要监视的特定属性名称的数组。如果未包含此属性，则对所有属性的更改都会触发变动通知，无默认值</p></li></ul></li> <li><p>takeRecords 从MutationObserver的通知队列中删除所有待处理的通知，并将它们返回到MutationRecord对象的新Array中</p></li></ul> <h3 id="shadow-dom"><a href="#shadow-dom" class="header-anchor">#</a> Shadow DOM</h3> <p>DOM相信我们做前端的都不陌生，而Shadow翻译过来就是阴影的意思，所以我们称Shadow DOM为影子DOM，它就像潜伏在宿主DOM身上的影子。使用Shadow DOM你甚至可以创建一个应用隐藏在标签内，它将创建在标准DOM tree中的一个指定节点下创建一个独立的环境，拥有属于自己的DOM tree并且不受外界的干扰。但是shadow DOM并不是一个完整的文档，它始终依附在标准DOM tree的子节点上，如果没有DOM那么shadow DOM也没有了用武之地。</p> <ul><li><p>隔离的DOM：组件的DOM是独立的（例如， <code>document.querySelector</code>不会返回组件的影子DOM中的节点）</p></li> <li><p>作用域CSS：在影子DOM中定义的CSS作用域。样式规则不会泄漏，页面样式也不会渗入</p></li> <li><p>组成：为组件设计一个基于声明的基于标记的API</p></li> <li><p>简化CSS-作用域DOM意味着您可以使用简单的CSS选择器，更通用的ID /类名，而不必担心命名冲突</p></li> <li><p>生产力-以DOM块而不是一个大型（全局）页面的形式考虑应用程序</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">.hi</span><span class="token punctuation">{</span>
      <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>shadow<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'textChange'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建 shadow-root</span>
    <span class="token keyword">var</span> shadow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#shadow'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 给 shadow-root 添加标签</span>
    shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;p class=hi&gt;Here is some new text&lt;/p&gt;&lt;button&gt;按钮&lt;/button&gt;'</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加CSS</span>
    shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">'&lt;style&gt;p { font-size: 24px; }&lt;/style&gt;'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> shadow<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> shadow<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启composed属性使外界可以监听到textChange事件</span>
      text<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'textChange'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>外界js可以使用Element.shadowRoot来获取标签下的shadow DOM。</p> <h3 id="template"><a href="#template" class="header-anchor">#</a> template</h3> <p>HTML内容模板<code>&lt;template&gt;</code>元素是一种用于保存客户端内容机制，该内容在加载页面时不会呈现，虽然解析器在加载页面时确实会处理<code>&lt;template&gt;</code>元素的内容，但这样做只是为了确保这些内容有效，但元素内容不会被渲染，但随后可以在运行时使用JavaScript实例化。将模板视为一个可存储在文档中以便后续使用的内容片段。</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>template<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">p</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>hi template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-ele</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-ele</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">let</span> tmpl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'my-ele'</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> HTMLElement <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> shadowRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shadowRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p><strong>cloneNode与importNode区别</strong></p> <p>在代码中我们看到cloneNode和importNode都有复制节点的作用，那么它们之间有什么区别呢？</p> <ul><li><p>cloneNode(deep) 在同一文档中使用cloneNode</p></li> <li><p>importNode(Nodes,deep) 克隆其他文档时使用</p></li></ul> <p><code>cloneNode</code>复制的节点身上依旧是其继承元素的API，而<code>importNode</code>切断与旧文档的联系，成为它自己的节点并共享DOM方法。</p> <h3 id="slot"><a href="#slot" class="header-anchor">#</a> slot</h3> <p>最炫的就是这个slot了，它可以让我们自定义插入自己想放置的元素和位置。用法和vue差不多直接上例子：</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-ele</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hi slot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-ele</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">class</span> <span class="token class-name">MyEle</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mode<span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> slot <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'slot'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
      text<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'hello Web Components'</span>
      style<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">':host-context(my-ele){color:red;}'</span>
      slot<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'diy'</span><span class="token punctuation">)</span>
      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>
      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'my-ele'</span><span class="token punctuation">,</span>MyEle<span class="token punctuation">)</span>
 
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p><strong>使用:host()选择器指定影子DOM的样式使外界可以覆盖掉（只能在影子DOM中使用），括号中的选择器参数必须和影子DOM的祖先相匹配</strong></p> <p>总结一下，在开发中我们使用自定义组件最好使用<code>template</code>组合<code>slot</code>作为模板，<code>html</code>解析到<code>template</code>会保存好但是不渲染，这时候我们可以给他渲染到自定义组件的影子DOM当中去，这就完事了，它们是完美的搭档。</p> <h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h2> <p><code>websocket</code>是除了<code>http</code>之外的另一个协议，它实现了服务端主动向客户端发送消息的功能，并且所有浏览器都支持。在没有<code>websocket</code>之前要保持与服务器的连接就是通过轮询的方式不断访问服务器以获得最新数据，不过这样会占用带宽并且给服务器增加压力，现在我们可以使用<code>websocket</code>来做即时通讯。</p> <p>使用起来还是比较简单，客户端使用示例：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'websocket地址'</span><span class="token punctuation">)</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打开连接'</span><span class="token punctuation">)</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'nihao'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'连接关闭'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'连接异常'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接收数据'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>服务端<code>nodejs</code>使用示例，需提前<code>npm</code>安装<code>nodejs-websocket</code>包：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;nodejs-websocket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token parameter">control</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  control<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span><span class="token parameter">res</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">接收客户端发来的数据</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    control<span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  control<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  control<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;异常关闭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="raf"><a href="#raf" class="header-anchor">#</a> RAF</h2> <p>RAF(requestAnimationFrame)是在浏览器重绘之前执行回调函数更新动画的方法，回调函数执行次数与浏览器屏幕刷新次数相匹配，所以性能更佳。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...动画逻辑</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> raf <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取消执行动画帧请求</span>
<span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>raf<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h2> <ol><li>获取比如窗口高度等全局属性使用局部变量保存起来，避免访问链路造成性能不佳</li> <li>循环调用事件使用setInterval替换setTimeout，可以优化内存访问量，setInterval只会申请一次内存运行，setTimeout每次都会申请一次新的内存空间</li> <li>使用creatDocumentFragment文档碎片把需要插入的节点保存在内存中，在循环完事后一次性插入到指定元素中，可以避免每次改变页面布局造成的重绘和重排</li> <li>使用cloneNode代替create创建元素标签，这样可以省去每次create都需要创建很多元素本身的属性</li> <li>在确定循环次数的时候使用do while合并循环减少判断次数</li> <li>创建数组和对象尽量采用字面量形式，new关键字创建会产生一些全局变量</li> <li>使用事件委托的形式给元素挂载事件</li> <li>在for循环中把遍历的数组长度用一个变量保存避免每次都需要重新读取数组长度</li> <li>尽量使用innerHTML创建DOM，使用create也会造成一点性能缺失</li></ol> <h2 id="流媒体开发"><a href="#流媒体开发" class="header-anchor">#</a> 流媒体开发</h2> <p>自从直播🔥热后，HTML5的媒体技术也迅速发展，下面我们了解一下流媒体技术。</p> <p><strong>HTML5<code>&lt;audio&gt;</code> 和 <code>&lt;video&gt;</code> 标签的限制</strong></p> <ul><li>不支持流</li> <li>不支持 DRM 和加密</li> <li>很难自定义控制, 以及保持跨浏览器的一致性</li> <li>编解码和封装在不同浏览器支持不同</li></ul> <h3 id="webrtc"><a href="#webrtc" class="header-anchor">#</a> WebRTC</h3> <p>Web Real-Time Communications 网页实时通信，简称WebRTC。WebRTC是一个HTML5规范，它允许用户在浏览器之间直接进行实时通信，不需要任何第三方插件。</p> <p>主要的三个API:</p> <ul><li>getUserMedia 获取本地媒体流</li> <li>RTCPeerConnection 创建对端连接并传输音频</li> <li>RTCDataChannel 传输二进制数据</li></ul> <h3 id="媒体设备"><a href="#媒体设备" class="header-anchor">#</a> 媒体设备</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 枚举所有设备</span>
<span class="token keyword">const</span> devices <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取用户设备</span>
<span class="token keyword">const</span> userMedia <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span>video<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="mse-media-source-extensions"><a href="#mse-media-source-extensions" class="header-anchor">#</a> MSE(Media Source Extensions)</h3> <p>MSE是解决HTML5的流问题。它使我们可以把通常的单个媒体文件的src值替换成引用MediaSource对象（一个包含即将播放的媒体文件的准备状态等信息的容器），以及引用多个SourceBuffer对象（代表多个组成整个串流的不同媒体块）的元素。MSE让我们能够根据内容获取的大小和频率，或是内存占用详情（例如什么时候缓存被回收），进行更加精准地控制。它是基于它可扩展的API建立自适应比特率流客户端（例如DASH或HLS的客户端）的基础。</p> <ul><li>sourceopen 绑定到媒体元素后开始触发</li> <li>sourceclosed 未绑定到媒体元素后开始触发</li> <li>sourceended 所有数据接收完成后触发</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// URL.createObjectURL() 创建的 url 并不会同步连接到 video.src。换句话说，URL.createObjectURL() 只是底层流（MS）和 video.src 的连接中间者，一旦两者连接到一起之后，该对象就没用了。那么什么时候 MS 才会和 video.src 连接到一起呢？创建实例都是同步的，但是底层流和 video.src 的连接是异步的。MS 提供了一个 sourceopen 事件给我们进行这项异步处理。一旦连接到一起之后，该 URL object 就没用了，处于内存节省的目的，可以使用 URL.revokeObjectURL(vidElement.src) 销毁指定的 URL object。</span>

mediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'sourceopen'</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">sourceOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>vidElement<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="获取位置信息"><a href="#获取位置信息" class="header-anchor">#</a> 获取位置信息</h2> <div class="language-js extra-class"><pre class="language-js"><code>
document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token comment">//firefox</span>

document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft <span class="token comment">//firefox</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token comment">//IE</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft <span class="token comment">//IE</span>

Element<span class="token punctuation">.</span>offsetLeft <span class="token comment">// 获取元素距离父元素左侧距离</span>

Element<span class="token punctuation">.</span>offsetTop <span class="token comment">// 获取元素距离父元素顶部距离</span>

Element<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 动态获取元素宽高和位置信息</span>

</code></pre></div><div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f47b2c40.js" defer></script><script src="/assets/js/2.af72bc87.js" defer></script><script src="/assets/js/16.8674dabe.js" defer></script><script src="/assets/js/7.2e35d67b.js" defer></script>
  </body>
</html>
